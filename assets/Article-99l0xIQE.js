import{a as A,i as y,j as e,R as S,m as G,B as d,F as ie,O as oe,Q as W,V,G as s,J as ce,r as o,c as de,u as ue,K as me,d as xe,C as pe,H as _e,P as je,M as fe,T as j}from"./index-BbLMk4Y2.js";import{c as L,D as he,a as ve,b as be,d as ge}from"./ArrowForwardIos-MamZqtTv.js";import{b as Ce,C as Se,a as R}from"./CardHeader-X2lp0rMt.js";import{C as Ae}from"./CardMedia-UUvlWbKT.js";import{L as ye}from"./LinearProgress-0ImYvmVZ.js";var z={},Ne=y;Object.defineProperty(z,"__esModule",{value:!0});var w=z.default=void 0,$e=Ne(A()),ke=e,Ie=(0,$e.default)((0,ke.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");w=z.default=Ie;var P={},Te=y;Object.defineProperty(P,"__esModule",{value:!0});var J=P.default=void 0,Me=Te(A()),Re=e,ze=(0,Me.default)((0,Re.jsx)("path",{d:"M11.07 12.85c.77-1.39 2.25-2.21 3.11-3.44.91-1.29.4-3.7-2.18-3.7-1.69 0-2.52 1.28-2.87 2.34L6.54 6.96C7.25 4.83 9.18 3 11.99 3c2.35 0 3.96 1.07 4.78 2.41.7 1.15 1.11 3.3.03 4.9-1.2 1.77-2.35 2.31-2.97 3.45-.25.46-.35.76-.35 2.24h-2.89c-.01-.78-.13-2.05.48-3.15zM14 20c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"}),"QuestionMark");J=P.default=ze;var D={},Pe=y;Object.defineProperty(D,"__esModule",{value:!0});var K=D.default=void 0,De=Pe(A()),Ee=e,Oe=(0,De.default)((0,Ee.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");K=D.default=Oe;var E={},Be=y;Object.defineProperty(E,"__esModule",{value:!0});var X=E.default=void 0,qe=Be(A()),Fe=e,He=(0,qe.default)((0,Fe.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank");X=E.default=He;const Qe=({content:f,title:h,subArticleIndex:N,done:n,handleGoToSubTestNow:x,selectedArticleNumber:$})=>{const[i,O]=S.useState(!1),[v,p]=S.useState(!1),u=()=>{p(!1)};return e.jsxs(S.Fragment,{children:[e.jsxs(Ce,{elevation:n?6:0,className:"subtopics_card",children:[e.jsx(Se,{avatar:n?e.jsx(K,{}):e.jsx(X,{}),titleTypographyProps:{variant:"h5"},title:h}),e.jsx(Ae,{component:"img",image:G,alt:"myImage"}),e.jsxs("div",{className:"hover_container",children:[" ",!i&&!n&&e.jsx(R,{disableSpacing:!0,children:e.jsx(d,{color:"secondary",onClick:()=>p(!0),endIcon:e.jsx(J,{}),"aria-expanded":i,size:"small",fullWidth:!0,variant:"contained",className:"learn-more-button",children:"Дізнатися більше"})}),n?null:e.jsx(R,{disableSpacing:!0,children:e.jsx(d,{onClick:()=>x($,N),endIcon:e.jsx(L,{}),color:"secondary",size:"small",fullWidth:!0,variant:"outlined",className:"goToTest",children:"Пройти тест"})})]}),i&&e.jsx(R,{disableSpacing:!0,children:e.jsx(d,{onClick:()=>p(!0),endIcon:e.jsx(w,{}),color:"secondary","aria-expanded":i,size:"small",fullWidth:!0,variant:"contained",className:"learn-more-button",children:"Згорнути"})})]}),e.jsxs(ie,{className:"modal_with_sub_article_info",fullWidth:!0,open:v,onClose:u,children:[e.jsx(he,{variant:"h4",id:"customized-dialog-title",children:h}),e.jsx(oe,{"aria-label":"close",onClick:u,sx:{position:"absolute",right:8,top:8,color:k=>k.palette.grey[500]},children:e.jsx(W,{})}),e.jsx(ve,{children:V(f)}),e.jsx(be,{children:e.jsxs(s,{container:!0,spacing:2,justifyContent:"end",children:[e.jsx(s,{item:!0,xs:"auto",children:e.jsx(d,{onClick:()=>x($,N),endIcon:e.jsx(L,{}),color:"primary",size:"medium",variant:"contained",className:"goToTest",children:"Пройти тест"})}),e.jsx(s,{item:!0,xs:"auto",children:e.jsx(d,{onClick:u,endIcon:e.jsx(W,{}),color:"secondary",size:"medium",variant:"outlined",children:"Close"})})]})})]})]})},Je=({setSelectedArticle:f,subArticleSuccessLevels:h,setSelectedSubArticle:N,historyList:n,isLoading:x,articleContentFromApp:$,currentUser:i})=>{const{selectedArticle:O}=ce(),[v,p]=o.useState(null);o.useState([]);const[u,k]=o.useState([]),[B,Y]=o.useState(0),[Z,U]=o.useState(0),[ee,te]=o.useState(0),[b,se]=o.useState(!1);h=[];const I=de(),r=parseInt(O||"0",10);o.useEffect(()=>{se(i.current_level>r)},[r,i]),o.useEffect(()=>{var l,c;f(r);const t=(l=n[r])==null?void 0:l.subtopics;k(t??[]);const a=(c=n[r])==null?void 0:c.content;p(typeof a=="object"?a:null)},[r]);const q=()=>{I(`/test/${r}`)},T=n[r],ae=ue(),ne=me(ae.breakpoints.up("md")),{isAuthenticated:F}=xe();o.useEffect(()=>{F||I("/")},[F]);const H=(t,a)=>{I(`/test/${t}/${a}`)},re=t=>{var C;if(i===null)return!1;let a=i.tests_completed_list;if(!a){console.error("User tests_completed_list is not available.");return}const l=a.find(_=>_.test_type==="Sub Article"&&_.event_id===t+1&&!_.completed);if(!l){console.error("No incomplete test found.");return}const c=(C=n[t])==null?void 0:C.subtopics;if(!c){console.error("SubArticle is not available.");return}const m=_=>c.findIndex(le=>le.sub_article_test_id===_),M=l.test_id,g=m(M);f(t),H(t,g)};o.useEffect(()=>{if(!n||r>=n.length)return;const t=n[r];if(t&&t.subtopics){const a=t.subtopics,l=a.length,c=a.reduce((m,M)=>{const g=i.tests_completed_list.find(C=>C.test_id===M.sub_article_test_id);return g&&g.completed&&(m+=1),m},0);te(l),U(c),Y(l>0?c/l*100:0)}},[n,r,i.tests_completed_list]);const Q=u.length>0&&!u.every(t=>{const a=i.tests_completed_list.find(l=>l.test_id===t.sub_article_test_id);return a&&a.completed});return e.jsxs(pe,{className:"article_page_container",children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",x?"Loading":`Тема ${T.text}`]})}),x?e.jsx(je,{}):e.jsxs(S.Fragment,{children:[e.jsx(s,{className:"back_button_container",container:!0,children:e.jsx(s,{item:!0,children:e.jsx(d,{component:fe,to:"/timeline",color:"secondary",startIcon:e.jsx(ge,{}),className:"close-button",children:"До Часопростору"})})}),e.jsx(j,{textAlign:"center",variant:"h6",className:"lesson",children:"Lesson"}),e.jsx(j,{textAlign:"center",className:"date",variant:"h5",children:T.date}),e.jsx(j,{textAlign:"center",className:"title",variant:"h4",children:T.text}),e.jsx(s,{container:!0,justifyContent:"center",children:e.jsx(s,{item:!0,xs:"auto",children:!b&&(Q?e.jsx(d,{className:"start_button_top",onClick:()=>re(r),variant:"contained",children:"Start Test"}):e.jsx(d,{className:"start_button_top",onClick:q,variant:"contained",children:"Start Test"}))})}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:12,md:5,children:[" ",e.jsx("img",{src:G,alt:""})]}),e.jsx(s,{item:!0,xs:12,md:7,children:e.jsx("div",{className:"content_container",children:n[r].content&&V(v||"")})})]}),u.length>0&&e.jsxs(s,{className:"subtopic_card_list",container:!0,justifyContent:"center",children:[!b&&e.jsx(s,{item:!0,xs:12,sm:12,md:6,xl:6,children:e.jsx(j,{variant:"h6",children:"Пройдіть додаткові завдання перед головним тестом"})}),!b&&e.jsx(s,{className:"additional_test_progress_container",container:!0,justifyContent:"center",children:e.jsxs(s,{item:!0,xs:12,sm:8,md:6,xl:4,children:[e.jsx(ye,{color:"primary",variant:"determinate",value:B}),e.jsxs(j,{className:"linear_progress_title",variant:"body2",gutterBottom:!0,children:["Виконано: ",Z," із ",ee," (",B.toFixed(2),"%)"]})]})}),e.jsxs(s,{item:!0,container:!0,xs:12,spacing:2,children:[u.map((t,a)=>{const l=i.tests_completed_list.find(m=>m.test_id===t.sub_article_test_id),c=l?l.completed:!1;return e.jsx(s,{item:!0,xs:12,sm:6,md:4,xl:3,children:e.jsx(Qe,{done:c,selectedArticleNumber:r,subArticleIndex:a,title:t.title,content:t.content,handleGoToSubTestNow:H})},a+"card")}),"                                "]})]}),!b&&e.jsx(s,{container:!0,justifyContent:"center",children:e.jsx(s,{item:!0,xs:12,sm:6,md:"auto",children:e.jsx(d,{disabled:Q,size:"large",fullWidth:!ne,variant:"contained",className:"quiz-button",onClick:q,children:"Завершити рівень"})})})]})]})};export{Je as default};
