import{r as b,g as he,a as ee,i as te,j as u,u as ve,R as W,m as ge,T as D,B as F,b as be,U as ye,c as _e,d as Te,C as Ce,H as xe,P as Oe}from"./index-0EF3_A9F.js";import{C as Se,a as je,b as we}from"./CardHeader-IvxBGOV-.js";import{C as Ve}from"./CardMedia-iz0L43hB.js";import{C as Ne}from"./CardContent-wJYXlm-E.js";import{L as Re}from"./LinearProgress-fomIbooW.js";var re={exports:{}},ke="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Ee=ke,Ie=Ee;function ne(){}function ie(){}ie.resetWarningCache=ne;var Me=function(){function e(a,t,i,d,o,s){if(s!==Ie){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}e.isRequired=e;function r(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,elementType:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:ie,resetWarningCache:ne};return n.PropTypes=n,n};re.exports=Me();var ae=re.exports,P={},oe={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var r={}.hasOwnProperty;function n(){for(var a=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var d=typeof i;if(d==="string"||d==="number")a.push(i);else if(Array.isArray(i)){if(i.length){var o=n.apply(null,i);o&&a.push(o)}}else if(d==="object"){if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]")){a.push(i.toString());continue}for(var s in i)r.call(i,s)&&i[s]&&a.push(s)}}}return a.join(" ")}e.exports?(n.default=n,e.exports=n):window.classNames=n})()})(oe);var se=oe.exports;P.__esModule=!0;P.default=void 0;var Pe=B(b),C=B(ae),$e=B(se);function B(e){return e&&e.__esModule?e:{default:e}}const le=({animate:e=!0,className:r="",layout:n="2-columns",lineColor:a="#FFF",children:t})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",a),Pe.default.createElement("div",{className:(0,$e.default)(r,"vertical-timeline",{"vertical-timeline--animate":e,"vertical-timeline--two-columns":n==="2-columns","vertical-timeline--one-column-left":n==="1-column"||n==="1-column-left","vertical-timeline--one-column-right":n==="1-column-right"})},t));le.propTypes={children:C.default.oneOfType([C.default.arrayOf(C.default.node),C.default.node]).isRequired,className:C.default.string,animate:C.default.bool,layout:C.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:C.default.string};var Ae=le;P.default=Ae;var $={};function z(){return z=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},z.apply(this,arguments)}function Fe(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,U(e,r)}function U(e,r){return U=Object.setPrototypeOf||function(a,t){return a.__proto__=t,a},U(e,r)}function We(e,r){if(e==null)return{};var n={},a=Object.keys(e),t,i;for(i=0;i<a.length;i++)t=a[i],!(r.indexOf(t)>=0)&&(n[t]=e[t]);return n}var q=new Map,E=new WeakMap,X=0,ce=void 0;function De(e){ce=e}function ze(e){return e?(E.has(e)||(X+=1,E.set(e,X.toString())),E.get(e)):"0"}function Ue(e){return Object.keys(e).sort().filter(function(r){return e[r]!==void 0}).map(function(r){return r+"_"+(r==="root"?ze(e.root):e[r])}).toString()}function qe(e){var r=Ue(e),n=q.get(r);if(!n){var a=new Map,t,i=new IntersectionObserver(function(d){d.forEach(function(o){var s,l=o.isIntersecting&&t.some(function(m){return o.intersectionRatio>=m});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=l),(s=a.get(o.target))==null||s.forEach(function(m){m(l,o)})})},e);t=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:r,observer:i,elements:a},q.set(r,n)}return n}function H(e,r,n,a){if(n===void 0&&(n={}),a===void 0&&(a=ce),typeof window.IntersectionObserver>"u"&&a!==void 0){var t=e.getBoundingClientRect();return r(a,{isIntersecting:a,target:e,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:t,intersectionRect:t,rootBounds:t}),function(){}}var i=qe(n),d=i.id,o=i.observer,s=i.elements,l=s.get(e)||[];return s.has(e)||s.set(e,l),l.push(r),o.observe(e),function(){l.splice(l.indexOf(r),1),l.length===0&&(s.delete(e),o.unobserve(e)),s.size===0&&(o.disconnect(),q.delete(d))}}var Be=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function Z(e){return typeof e.children!="function"}var M=function(e){Fe(r,e);function r(a){var t;return t=e.call(this,a)||this,t.node=null,t._unobserveCb=null,t.handleNode=function(i){t.node&&(t.unobserve(),!i&&!t.props.triggerOnce&&!t.props.skip&&t.setState({inView:!!t.props.initialInView,entry:void 0})),t.node=i||null,t.observeNode()},t.handleChange=function(i,d){i&&t.props.triggerOnce&&t.unobserve(),Z(t.props)||t.setState({inView:i,entry:d}),t.props.onChange&&t.props.onChange(i,d)},t.state={inView:!!a.initialInView,entry:void 0},t}var n=r.prototype;return n.componentDidUpdate=function(t){(t.rootMargin!==this.props.rootMargin||t.root!==this.props.root||t.threshold!==this.props.threshold||t.skip!==this.props.skip||t.trackVisibility!==this.props.trackVisibility||t.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},n.componentWillUnmount=function(){this.unobserve(),this.node=null},n.observeNode=function(){if(!(!this.node||this.props.skip)){var t=this.props,i=t.threshold,d=t.root,o=t.rootMargin,s=t.trackVisibility,l=t.delay,m=t.fallbackInView;this._unobserveCb=H(this.node,this.handleChange,{threshold:i,root:d,rootMargin:o,trackVisibility:s,delay:l},m)}},n.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},n.render=function(){if(!Z(this.props)){var t=this.state,i=t.inView,d=t.entry;return this.props.children({inView:i,entry:d,ref:this.handleNode})}var o=this.props,s=o.children,l=o.as,m=We(o,Be);return b.createElement(l||"div",z({ref:this.handleNode},m),s)},r}(b.Component);M.displayName="InView";M.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function He(e){var r=e===void 0?{}:e,n=r.threshold,a=r.delay,t=r.trackVisibility,i=r.rootMargin,d=r.root,o=r.triggerOnce,s=r.skip,l=r.initialInView,m=r.fallbackInView,v=b.useRef(),y=b.useState({inView:!!l}),h=y[0],S=y[1],j=b.useCallback(function(T){v.current!==void 0&&(v.current(),v.current=void 0),!s&&T&&(v.current=H(T,function(V,k){S({inView:V,entry:k}),k.isIntersecting&&o&&v.current&&(v.current(),v.current=void 0)},{root:d,rootMargin:i,threshold:n,trackVisibility:t,delay:a},m))},[Array.isArray(n)?n.toString():n,d,i,o,s,t,m,a]);b.useEffect(function(){!v.current&&h.entry&&!o&&!s&&S({inView:!!l})});var g=[j,h.inView,h.entry];return g.ref=g[0],g.inView=g[1],g.entry=g[2],g}const Ge=Object.freeze(Object.defineProperty({__proto__:null,InView:M,default:M,defaultFallbackInView:De,observe:H,useInView:He},Symbol.toStringTag,{value:"Module"})),Ke=he(Ge);$.__esModule=!0;$.default=void 0;var x=G(b),p=G(ae),I=G(se),Ye=Ke;function G(e){return e&&e.__esModule?e:{default:e}}const ue=({children:e="",className:r="",contentArrowStyle:n=null,contentStyle:a=null,date:t="",dateClassName:i="",icon:d=null,iconClassName:o="",iconOnClick:s=null,onTimelineElementClick:l=null,iconStyle:m=null,id:v="",position:y="",style:h=null,textClassName:S="",intersectionObserverProps:j={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:g=!1})=>x.default.createElement(Ye.InView,j,({inView:T,ref:V})=>x.default.createElement("div",{ref:V,id:v,className:(0,I.default)(r,"vertical-timeline-element",{"vertical-timeline-element--left":y==="left","vertical-timeline-element--right":y==="right","vertical-timeline-element--no-children":e===""}),style:h},x.default.createElement(x.default.Fragment,null,x.default.createElement("span",{style:m,onClick:s,className:(0,I.default)(o,"vertical-timeline-element-icon",{"bounce-in":T||g,"is-hidden":!(T||g)})},d),x.default.createElement("div",{style:a,onClick:l,className:(0,I.default)(S,"vertical-timeline-element-content",{"bounce-in":T||g,"is-hidden":!(T||g)})},x.default.createElement("div",{style:n,className:"vertical-timeline-element-content-arrow"}),e,x.default.createElement("span",{className:(0,I.default)(i,"vertical-timeline-element-date")},t)))));ue.propTypes={children:p.default.oneOfType([p.default.arrayOf(p.default.node),p.default.node]),className:p.default.string,contentArrowStyle:p.default.shape({}),contentStyle:p.default.shape({}),date:p.default.node,dateClassName:p.default.string,icon:p.default.element,iconClassName:p.default.string,iconStyle:p.default.shape({}),iconOnClick:p.default.func,onTimelineElementClick:p.default.func,id:p.default.string,position:p.default.string,style:p.default.shape({}),textClassName:p.default.string,visible:p.default.bool,intersectionObserverProps:p.default.shape({root:p.default.object,rootMargin:p.default.string,threshold:p.default.number,triggerOnce:p.default.bool})};var Je=ue;$.default=Je;var L={VerticalTimeline:P.default,VerticalTimelineElement:$.default},K={},Qe=te;Object.defineProperty(K,"__esModule",{value:!0});var de=K.default=void 0,Xe=Qe(ee()),Ze=u,Le=(0,Xe.default)((0,Ze.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUncheckedRounded");de=K.default=Le;var Y={},et=te;Object.defineProperty(Y,"__esModule",{value:!0});var fe=Y.default=void 0,tt=et(ee()),rt=u,nt=(0,tt.default)((0,rt.jsx)("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"CheckCircleOutline");fe=Y.default=nt;const it=({event:e,index:r,handleExpandArticle:n,handleGoToTestNow:a,handleGoToSubArticleTest:t,successLevel:i,isAllSubtaskDone:d,totalSubtopics:o,completedSubtopics:s})=>{const l=ve(),m=i<r,v=m?l.palette.text.disabled:l.palette.text.primary,y=o>0?s/o*100:0;return u.jsxs(W.Fragment,{children:[u.jsx(Se,{titleTypographyProps:{color:v},title:e.date}),u.jsx(Ve,{className:m?"imageOpacity":"",component:"img",height:"194",image:ge,alt:"city"}),u.jsx(Ne,{children:u.jsx(D,{color:v,component:"div",children:e.text})}),u.jsxs(je,{disableSpacing:!0,sx:{flexWrap:"wrap"},children:[u.jsx(F,{variant:"outlined",color:"secondary",size:"small",sx:{mb:1},fullWidth:!0,disabled:m,className:"learn-more-button",onClick:h=>{h.stopPropagation(),n(r)},children:"Дізнатися більше"}),i===r&&(d?u.jsx(F,{size:"large",variant:"contained",fullWidth:!0,disabled:m,className:"goToTest",onClick:h=>{h.stopPropagation(),a(r)},children:"Завершити рівень"}):u.jsxs(W.Fragment,{children:[u.jsxs("div",{className:"progress_bar_container",children:[u.jsx(Re,{color:"primary",variant:"determinate",value:y}),u.jsxs(D,{variant:"body2",gutterBottom:!0,children:["Виконано: ",s," із ",o," (",y.toFixed(2),"%)"]})]}),u.jsx(F,{size:"large",variant:"contained",fullWidth:!0,className:"goToTest",onClick:h=>{h.stopPropagation(),t(r)},children:"Пройти завдання"})]}))]})]})},ut=({historyList:e,buttonStates:r,successLevels:n,setSelectedArticle:a,selectedArticle:t,subArticleSuccessLevels:i,setSelectedSubArticle:d,isLoading:o})=>{const s=be(),{currentUser:l}=b.useContext(ye);console.log("start HistoryTimeline");const[m,v]=b.useState(null),y=f=>f?s.palette.primary.contrastText:s.palette.primary.main,h=_e(),S=f=>{a(f),h(`/article/${f}`)},j=f=>{h(`/test/${f}`),a(f)},g=(f,c)=>{h(`/test/${f}/${c}`),a(f),d(c)};b.useEffect(()=>{e&&v(e[t].subtopics)},[t,e]);const T=f=>{var Q;if(l===null)return!1;let c=l.tests_completed_list;if(!c){console.error("User tests_completed_list is not available.");return}const _=c.find(R=>R.test_type==="Sub Article"&&R.event_id===f+1&&!R.completed);if(!_){console.error("No incomplete test found.");return}const O=(Q=e[f])==null?void 0:Q.subtopics;if(!O){console.error("SubArticle is not available.");return}const w=R=>O.findIndex(me=>me.sub_article_test_id===R),N=_.test_id,A=w(N);a(f),g(f,A)},V=f=>{const c=e[f];return!c||!c.subtopics?0:c.subtopics.reduce((_,O)=>{const w=l==null?void 0:l.tests_completed_list;let N;return w&&(N=w.find(A=>A.test_id===O.sub_article_test_id)),N&&N.completed?_+1:_},0)};b.useEffect(()=>{m&&m.length>0&&m.findIndex((f,c)=>{var _;return!((_=i[t])!=null&&_[c])})},[m,i,t,g,j]);const k=f=>{const c=e[f];return!c||!l||!c.subtopics?!1:c.subtopics.every(_=>{const O=l.tests_completed_list.find(w=>w.test_id===_.sub_article_test_id);return O&&O.completed})},pe=f=>{const c=e[f];return c&&c.subtopics?c.subtopics.length:0},{isAuthenticated:J}=Te();return b.useEffect(()=>{J||h("/")},[J]),u.jsxs(Ce,{className:"history_timeline_page",children:[u.jsx(xe,{children:u.jsx("title",{children:"Часопростір"})}),u.jsx(D,{className:"main_title",textAlign:"center",component:"h1",variant:"h3",children:"Часопростір"}),u.jsx(L.VerticalTimeline,{lineColor:s.palette.primary.light,children:o?u.jsx(Oe,{}):e&&e.length>0?e.map((f,c)=>u.jsx(W.Fragment,{children:u.jsx(L.VerticalTimelineElement,{dateClassName:"hidden",className:n===c?"current_active_vertical_timeline_element":"",iconStyle:{background:s.palette.primary.light,color:y(n>c)},contentStyle:{padding:0,boxShadow:"none"},icon:n>=c+1?u.jsx(fe,{}):u.jsx(de,{}),children:u.jsx(we,{elevation:n>=c?4:1,children:u.jsx(it,{completedSubtopics:V(c),totalSubtopics:pe(c),isAllSubtaskDone:k(c),event:f,index:c,handleExpandArticle:S,handleGoToSubArticleTest:T,handleGoToTestNow:j,successLevel:n})})},c+"history-timeline")},c+"TimelineCard")):u.jsx("div",{children:"data not found..."})})]})};export{ut as default};
