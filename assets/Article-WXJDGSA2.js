import{a as N,i as $,j as e,R as S,m as W,B as u,F as X,Q as Y,V as L,W as F,G as s,M as Z,r as y,c as U,u as ee,N as te,d as se,C as ne,H as ae,P as re,L as le,T as j}from"./index-FhRXRgts.js";import{D as ie,a as ce,b as oe,d as de}from"./ArrowBackIos-wUEpAEH2.js";import{d as q}from"./ArrowForwardIos-45XLeI7S.js";import{b as ue,C as me,a as I}from"./CardHeader-uWSKWb5x.js";import{C as xe}from"./CardMedia-1UXRZZMs.js";import{L as pe}from"./LinearProgress-ZeSmHl5B.js";var P={},je=$;Object.defineProperty(P,"__esModule",{value:!0});var H=P.default=void 0,_e=je(N()),he=e,fe=(0,_e.default)((0,he.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");H=P.default=fe;var M={},ve=$;Object.defineProperty(M,"__esModule",{value:!0});var Q=M.default=void 0,be=ve(N()),ge=e,Ce=(0,be.default)((0,ge.jsx)("path",{d:"M11.07 12.85c.77-1.39 2.25-2.21 3.11-3.44.91-1.29.4-3.7-2.18-3.7-1.69 0-2.52 1.28-2.87 2.34L6.54 6.96C7.25 4.83 9.18 3 11.99 3c2.35 0 3.96 1.07 4.78 2.41.7 1.15 1.11 3.3.03 4.9-1.2 1.77-2.35 2.31-2.97 3.45-.25.46-.35.76-.35 2.24h-2.89c-.01-.78-.13-2.05.48-3.15zM14 20c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"}),"QuestionMark");Q=M.default=Ce;var R={},Ae=$;Object.defineProperty(R,"__esModule",{value:!0});var G=R.default=void 0,ye=Ae(N()),Se=e,Ne=(0,ye.default)((0,Se.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");G=R.default=Ne;var T={},$e=$;Object.defineProperty(T,"__esModule",{value:!0});var V=T.default=void 0,ke=$e(N()),Ie=e,Pe=(0,ke.default)((0,Ie.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank");V=T.default=Pe;const Me=({content:g,title:a,subArticleIndex:_,done:r,handleGoToSubTestNow:C,selectedArticleNumber:t})=>{const[x,h]=S.useState(!1),[n,f]=S.useState(!1),v=()=>{f(!1)};return e.jsxs(S.Fragment,{children:[e.jsxs(ue,{elevation:r?6:0,className:"subtopics_card",children:[e.jsx(me,{avatar:r?e.jsx(G,{}):e.jsx(V,{}),titleTypographyProps:{variant:"h5"},title:a}),e.jsx(xe,{component:"img",image:W,alt:"myImage"}),e.jsxs("div",{className:"hover_container",children:[" ",!x&&!r&&e.jsx(I,{disableSpacing:!0,children:e.jsx(u,{color:"secondary",onClick:()=>f(!0),endIcon:e.jsx(Q,{}),"aria-expanded":x,size:"small",fullWidth:!0,variant:"contained",className:"learn-more-button",children:"Дізнатися більше"})}),r?null:e.jsx(I,{disableSpacing:!0,children:e.jsx(u,{onClick:()=>C(t,_),endIcon:e.jsx(q,{}),color:"secondary",size:"small",fullWidth:!0,variant:"outlined",className:"goToTest",children:"Пройти тест"})})]}),x&&e.jsx(I,{disableSpacing:!0,children:e.jsx(u,{onClick:()=>f(!0),endIcon:e.jsx(H,{}),color:"secondary","aria-expanded":x,size:"small",fullWidth:!0,variant:"contained",className:"learn-more-button",children:"Згорнути"})})]}),e.jsxs(X,{className:"modal_with_sub_article_info",fullWidth:!0,open:n,onClose:v,children:[e.jsx(ie,{variant:"h4",id:"customized-dialog-title",children:a}),e.jsx(Y,{"aria-label":"close",onClick:v,sx:{position:"absolute",right:8,top:8,color:A=>A.palette.grey[500]},children:e.jsx(L,{})}),e.jsx(ce,{children:F(g)}),e.jsx(oe,{children:e.jsxs(s,{container:!0,spacing:2,justifyContent:"end",children:[e.jsx(s,{item:!0,xs:"auto",children:e.jsx(u,{onClick:()=>C(t,_),endIcon:e.jsx(q,{}),color:"primary",size:"medium",variant:"contained",className:"goToTest",children:"Пройти тест"})}),e.jsx(s,{item:!0,xs:"auto",children:e.jsx(u,{onClick:v,endIcon:e.jsx(L,{}),color:"secondary",size:"medium",variant:"outlined",children:"Close"})})]})})]})]})},Oe=({setSelectedArticle:g,historyList:a,isLoading:_,currentUser:r})=>{var D,B,E,O;const{selectedArticle:C}=Z(),[t,x]=y.useState({currentArticleContent:null,subArticlesArray:[],completionPercentage:0,completedSubtopics:0,totalSubtopics:0,currentLevelCompleted:!1}),h=U(),n=parseInt(C||"0",10),f=ee(),v=te(f.breakpoints.up("md")),{isAuthenticated:A}=se();y.useEffect(()=>{A||h("/")},[A]),y.useEffect(()=>{var c,o;g(n);const l=((c=a[n])==null?void 0:c.subtopics)??[],i=((o=a[n])==null?void 0:o.content)??null;x(d=>({...d,currentLevelCompleted:r.current_level>n,subArticlesArray:l,currentArticleContent:typeof i=="object"?i:null}))},[n,a,r]),y.useEffect(()=>{(()=>{const i=a[n];if(!i||!i.subtopics)return;const c=i.subtopics,o=c.length,d=c.reduce((m,k)=>{const b=r.tests_completed_list.find(p=>p.test_id===k.sub_article_test_id);return b&&b.completed&&(m+=1),m},0);x(m=>({...m,totalSubtopics:o,completedSubtopics:d,completionPercentage:o>0?d/o*100:0}))})()},[a,n,r]);const w=l=>{var b;if(r===null)return;const c=r.tests_completed_list.find(p=>p.test_type==="Sub Article"&&p.event_id===l+1&&!p.completed);if(!c){console.error("No incomplete test found.");return}const o=(b=a[l])==null?void 0:b.subtopics;if(!o){console.error("SubArticle is not available.");return}const d=p=>o.findIndex(K=>K.sub_article_test_id===p),m=c.test_id,k=d(m);g(l),h(`/test/${l}/${k}`)},z=()=>{h(`/test/${n}`)},J=t.subArticlesArray.length>0&&!t.subArticlesArray.every(l=>{const i=r.tests_completed_list.find(c=>c.test_id===l.sub_article_test_id);return i&&i.completed});return e.jsxs(ne,{className:"article_page_container",children:[e.jsx(ae,{children:e.jsx("title",{children:_?"Loading":`Тема ${(D=a[n])==null?void 0:D.text}`})}),_?e.jsx(re,{}):e.jsxs(S.Fragment,{children:[e.jsx(s,{className:"back_button_container",container:!0,children:e.jsx(s,{item:!0,children:e.jsx(u,{component:le,to:"/timeline",color:"secondary",startIcon:e.jsx(de,{}),className:"close-button",children:"До Часопростору"})})}),e.jsx(j,{textAlign:"center",variant:"h6",className:"lesson",children:"Lesson"}),e.jsx(j,{textAlign:"center",className:"date",variant:"h5",children:(B=a[n])==null?void 0:B.date}),e.jsx(j,{textAlign:"center",className:"title",variant:"h4",children:(E=a[n])==null?void 0:E.text}),e.jsx(s,{container:!0,justifyContent:"center",children:e.jsx(s,{item:!0,xs:"auto",children:!t.currentLevelCompleted&&(J?e.jsx(u,{className:"start_button_top",onClick:()=>w(n),variant:"contained",children:"Start Test"}):e.jsx(u,{className:"start_button_top",onClick:z,variant:"contained",children:"Start Test"}))})}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:12,md:5,children:[" ",e.jsx("img",{src:W,alt:""})]}),e.jsx(s,{item:!0,xs:12,md:7,children:e.jsx("div",{className:"content_container",children:((O=a[n])==null?void 0:O.content)&&F(t.currentArticleContent?t.currentArticleContent:"")})})]}),t.subArticlesArray.length>0&&e.jsxs(s,{className:"subtopic_card_list",container:!0,justifyContent:"center",children:[!t.currentLevelCompleted&&e.jsx(s,{item:!0,xs:12,sm:12,md:6,xl:6,children:e.jsx(j,{variant:"h6",children:"Пройдіть додаткові завдання перед головним тестом"})}),!t.currentLevelCompleted&&e.jsx(s,{className:"additional_test_progress_container",container:!0,justifyContent:"center",children:e.jsxs(s,{item:!0,xs:12,sm:8,md:6,xl:4,children:[e.jsx(pe,{color:"primary",variant:"determinate",value:t.completionPercentage}),e.jsxs(j,{className:"linear_progress_title",variant:"body2",gutterBottom:!0,children:["Виконано: ",t.completedSubtopics," із ",t.totalSubtopics," (",t.completionPercentage.toFixed(2),"%)"]})]})}),e.jsx(s,{item:!0,container:!0,xs:12,spacing:2,children:t.subArticlesArray.map((l,i)=>{const c=r.tests_completed_list.find(d=>d.test_id===l.sub_article_test_id),o=c?c.completed:!1;return e.jsx(s,{item:!0,xs:12,sm:6,md:4,xl:3,children:e.jsx(Me,{done:o,selectedArticleNumber:n,subArticleIndex:i,title:l.title,content:l.content,handleGoToSubTestNow:(d,m)=>h(`/test/${d}/${m}`)})},i+"card")})})]}),!t.currentLevelCompleted&&e.jsx(s,{container:!0,justifyContent:"center",children:e.jsxs(s,{item:!0,xs:12,children:[t.subArticlesArray.length>0&&t.completionPercentage<100&&e.jsx(j,{textAlign:"center",variant:"h6",children:"Пройдіть всі додаткові тести, щоб розблокувати головний тест"}),e.jsx(s,{container:!0,justifyContent:"center",children:e.jsx(s,{item:!0,xs:12,sm:6,md:"auto",children:e.jsx(u,{disabled:t.completionPercentage<100,onClick:z,size:"large",fullWidth:!v,variant:"contained",className:"quiz-button",children:"Завершити рівень"})})})]})})]})]})};export{Oe as default};
